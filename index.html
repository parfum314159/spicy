<!DOCTYPE html>
<html>
<head>
  <title>Spicy Library</title>
  <style>
    body {
      font-family: Arial;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    h1 {
      color: #ff4500;
    }
    .book {
      border: 1px solid #444;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      background-color: #222;
      max-width: 300px;
      display: inline-block;
      margin-right: 20px;
      vertical-align: top;
    }
    img {
      display: block;
      margin-bottom: 10px;
    }
    button.pi-pay {
      background-color: #00b300;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 8px;
    }
    button.pi-pay:hover {
      background-color: #00d000;
    }
  </style>

  <!-- Pi SDK Script (??? Pi) -->
  <script src="https://sandbox.minepi.com/marketplace/pi.js"></script>

</head>
<body>

  <h1>?? Welcome to Spicy Library</h1>
  <p>Pay with Pi directly using your Pi Wallet (inside Pi Browser)</p>

  <div id="books"></div>

  <script>

    const books = [
      { title: "Love Story", author: "Asmanour", pricePi: 5, cover: "cover1.jpg" },
      { title: "Adventure Tales", author: "John Doe", pricePi: 3, cover: "cover2.jpg" },
      { title: "Tech & Web3", author: "Jane Smith", pricePi: 7, cover: "cover3.jpg" }
    ];

    const booksDiv = document.getElementById("books");

    books.forEach(book => {
      booksDiv.innerHTML += `
        <div class="book">
          <img src="${book.cover}" alt="${book.title}" width="200">
          <h2>${book.title}</h2>
          <p>Author: ${book.author}</p>
          <p>Price: ${book.pricePi} Pi</p>
          <button class="pi-pay" onclick="payWithPi('${book.title}', ${book.pricePi})">
            Pay with Pi
          </button>
        </div>
      `;
    });

    async function payWithPi(title, price) {
      if (!window.Pi) {
        alert("Pi SDK not available. Open this page inside Pi Browser.");
        return;
      }

      try {
        // ???? ???????? ?? Pi
        await Pi.authenticate();

        // ????? ?????
        const payment = await Pi.createPayment({
          amount: price.toString(),
          currency: "Pi",
          memo: `Buy ${title}`
        });

        if (payment) {
          alert(`Payment sent: ${payment.id}`);
        } else {
          alert("Payment failed or cancelled.");
        }
      } catch (err) {
        console.error(err);
        alert("Error with Pi Payment.");
      }
    }

  </script>

</body>
</html>
